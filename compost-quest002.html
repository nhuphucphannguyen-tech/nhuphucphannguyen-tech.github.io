<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Compost Quest ‚Äî Ph√¢n h·ªØu c∆° sinh h·ªçc</title>
  <style>
    :root{--bg:#f3f7ef;--panel:#ffffff;--accent:#4caf50;--muted:#6b7280}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#e8f5e9 0%,#f3f7ef 100%);display:flex;align-items:center;justify-content:center;padding:20px}
    .game-wrap{width:980px;max-width:98%;background:var(--panel);box-shadow:0 10px 30px rgba(20,30,20,0.08);border-radius:12px;overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid #eef2ea}
    header h1{font-size:20px;margin:0;color:#0f5132}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.secondary{background:#e6f4ea;color:#0f5132;border:1px solid #d0edd7}
    .main{display:flex;gap:18px;padding:18px}
    .left{flex:1;min-height:480px;background:linear-gradient(180deg,#ffffff,#f9fff4);border-radius:10px;padding:12px;position:relative}
    .right{width:320px}
    .area{height:420px;border-radius:8px;border:2px dashed #d9eadf;display:flex;align-items:flex-end;justify-content:center;position:relative;padding:12px}
    .bin{width:220px;height:180px;background:linear-gradient(180deg,#6b8f4b,#43602b);border-radius:12px 12px 18px 18px;position:relative;box-shadow:inset 0 -10px 30px rgba(0,0,0,0.12)}
    .bin:after{content:'';position:absolute;left:50%;transform:translateX(-50%);top:-22px;width:260px;height:46px;background:#3f6b2f;border-radius:10px}
    .item-pool{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .item{width:80px;height:80px;background:#fff;border-radius:10px;border:1px solid #e6efe6;display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:grab}
    .item p{margin:0;font-size:12px}
    .hud{display:flex;gap:10px;align-items:center}
    .meter{height:16px;background:#e9f6ea;border-radius:8px;overflow:hidden;width:100%}
    .meter > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,#b7e1a7,#4caf50)}
    .panel{background:#fff;border-radius:10px;padding:12px;box-shadow:0 4px 12px rgba(10,20,10,0.03)}
    .score{font-size:18px;color:#0f5132}
    .log{height:160px;overflow:auto;border-top:1px dashed #eef6ec;padding-top:8px;margin-top:8px;font-size:13px;color:var(--muted)}
    .quiz{position:absolute;inset:18px;background:rgba(255,255,255,0.98);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;border-radius:10px;flex-direction:column;padding:18px}
    .quiz.show{display:flex}
    .quiz h3{margin:0 0 8px 0}
    .footer{padding:12px 18px;border-top:1px solid #eef2ea;display:flex;justify-content:space-between;align-items:center}
    .small{font-size:13px;color:var(--muted)}
    .badge{background:#fff;border:1px solid #e3f3df;padding:6px 8px;border-radius:8px}
    .hint{font-size:13px;color:#0b6a3a}
    .center{text-align:center}
    .item .icon{font-size:28px}
    .hot{animation:pop 0.9s infinite}
    @keyframes pop{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
    /* responsive */
    @media(max-width:880px){.right{display:none}.main{flex-direction:column}.area{height:320px}}
  </style>
</head>
<body>
  <div class="game-wrap" role="application">
    <header>
      <h1>Compost Quest ‚Äî Ph√¢n h·ªØu c∆° sinh h·ªçc</h1>
      <div class="controls">
        <button id="startBtn">B·∫Øt ƒë·∫ßu</button>
        <button class="secondary" id="resetBtn">ƒê·∫∑t l·∫°i</button>
      </div>
    </header>

    <div class="main">
      <div class="left panel">
        <div class="hud">
          <div style="width:56%">
            <div class="small">M·ª©c tr∆∞·ªüng th√†nh ph√¢n</div>
            <div class="meter" aria-hidden><i id="compostMeter"></i></div>
          </div>
          <div style="width:44%">
            <div class="small">ƒêi·ªÉm</div>
            <div class="score" id="score">0</div>
          </div>
        </div>

        <div class="area" id="playArea">
          <div class="bin" id="compostBin" title="K√©o c√°c v·∫≠t v√†o ƒë√¢y ƒë·ªÉ ·ªß ph√¢n"></div>

          <div class="quiz" id="quizBox" aria-live="polite">
            <h3 id="quizQ">C√¢u h·ªèi</h3>
            <div id="quizAnswers"></div>
            <div style="margin-top:10px"><button id="closeQuiz">Ti·∫øp t·ª•c</button></div>
          </div>
        </div>

        <div class="item-pool" id="itemPool" style="margin-top:12px">
          <!-- items generated by JS -->
        </div>

        <div class="log" id="log">S·∫µn s√†ng! Nh·∫•n "B·∫Øt ƒë·∫ßu" ƒë·ªÉ ch∆°i. K√©o th·ª±c ph·∫©m v√† v·∫≠t li·ªáu v√†o th√πng ·ªß.</div>
      </div>

      <aside class="right">
        <div class="panel" style="margin-bottom:12px">
          <div class="small">M·ª•c ti√™u</div>
          <ul>
            <li>Thu th·∫≠p v·∫≠t th·∫£i h·ªØu c∆° (v·ªè tr√°i c√¢y, rau, r∆°m...).</li>
            <li>Tr√°nh cho v·∫≠t kh√¥ng ph√π h·ª£p (nh·ª±a, kim lo·∫°i) v√†o th√πng.</li>
            <li>Ho√†n th√†nh 3 m·ª©c tr∆∞·ªüng th√†nh ƒë·ªÉ th·∫Øng.</li>
          </ul>
        </div>

        <div class="panel" style="margin-bottom:12px">
          <div class="small">H∆∞·ªõng d·∫´n nhanh</div>
          <ol style="padding-left:16px;margin:8px 0">
            <li>K√©o v·∫≠t v√†o th√πng ·ªß</li>
            <li>M·ªói v·∫≠t c√≥ ƒëi·ªÉm v√† th·ªùi gian ph√¢n h·ªßy kh√°c nhau</li>
            <li>ƒê·∫°t 100% meter ƒë·ªÉ thu ho·∫°ch ph√¢n h·ªØu c∆°</li>
          </ol>
        </div>

        <div class="panel">
          <div class="small">Th√¥ng tin nhanh</div>
          <p class="hint">Ph√¢n h·ªØu c∆° sinh h·ªçc (compost) l√† s·∫£n ph·∫©m ph√¢n h·ªßy t·ª´ ch·∫•t h·ªØu c∆° ‚Äî gi√∫p c·∫£i t·∫°o ƒë·∫•t, gi·ªØ ·∫©m v√† b·ªï sung dinh d∆∞·ª°ng cho c√¢y tr·ªìng.</p>
          <div style="margin-top:8px" class="badge">M·∫πo: K·∫øt h·ª£p ch·∫•t xanh v√† ch·∫•t n√¢u ƒë·ªÉ c√¢n b·∫±ng C:N</div>
        </div>
      </aside>
    </div>

    <div class="footer">
      <div class="small">Phi√™n b·∫£n demo ‚Ä¢ Thi·∫øt k·∫ø: ChatGPT</div>
      <div class="small">M·∫πo: B·∫°n c√≥ th·ªÉ ch·ªânh m√£ ƒë·ªÉ th√™m v·∫≠t, c√¢u h·ªèi quiz, ho·∫∑c thay h√¨nh.</div>
    </div>
  </div>

  <script>
    // Game data
    const ITEMS = [
      {id:'apple', name:'V·ªè t√°o', icon:'üçé', type:'green', points:10, decompose:8, info:'Gi√†u n∆∞·ªõc, d·ªÖ ph√¢n h·ªßy (xanh).'},
      {id:'banana', name:'V·ªè chu·ªëi', icon:'üçå', type:'green', points:12, decompose:10, info:'T·ªët cho ph√¢n, gi√†u ch·∫•t dinh d∆∞·ª°ng.'},
      {id:'vegetable', name:'Rau th·ª´a', icon:'ü•¨', type:'green', points:9, decompose:7, info:'Th·ª±c ph·∫©m t∆∞∆°i d·ªÖ ph√¢n h·ªßy.'},
      {id:'coffee', name:'B√£ c√† ph√™', icon:'‚òï', type:'green', points:8, decompose:6, info:'Gi√∫p tƒÉng ƒë·ªô m√πn.'},
      {id:'egg', name:'V·ªè tr·ª©ng', icon:'ü•ö', type:'brown', points:6, decompose:20, info:'Ch·ª©a canxi, kh√≥ ph√¢n h·ªßy h∆°n.'},
      {id:'paper', name:'Gi·∫•y', icon:'üìÑ', type:'brown', points:7, decompose:30, info:'C·∫ßn x√© nh·ªè, t·ªët cho c·∫•u tr√∫c.'},
      {id:'straw', name:'R∆°m', icon:'üåæ', type:'brown', points:5, decompose:35, info:'Ch·∫•t n√¢u gi√∫p gi·ªØ c·∫•u tr√∫c.'},
      {id:'meat', name:'Th·ªãt', icon:'üçñ', type:'bad', points:-8, decompose:60, info:'Kh√¥ng n√™n cho v√†o v√¨ m√πi v√† s√¢u b·ªç.'},
      {id:'plastic', name:'Nh·ª±a', icon:'üß¥', type:'bad', points:-15, decompose:9999, info:'Kh√¥ng ph√¢n h·ªßy ‚Äî kh√¥ng cho v√†o.'},
      {id:'metal', name:'Kim lo·∫°i', icon:'üî©', type:'bad', points:-20, decompose:9999, info:'Kh√¥ng ph√¢n h·ªßy ‚Äî g√¢y h·∫°i.'}
    ];

    const QUIZZES = [
      {q:"T·∫°i sao c·∫ßn k·∫øt h·ª£p ch·∫•t xanh v√† ch·∫•t n√¢u trong ·ªß ph√¢n?", a:["ƒê·ªÉ c√¢n b·∫±ng t·ªâ l·ªá C:N", "ƒê·ªÉ tƒÉng pH", "ƒê·ªÉ t·∫°o m√πi th∆°m"], correct:0},
      {q:"V·∫≠t n√†o sau ƒë√¢y KH√îNG n√™n b·ªè v√†o th√πng ·ªß?", a:["V·ªè chu·ªëi", "Nh·ª±a", "B√£ c√† ph√™"], correct:1},
      {q:"Ph√¢n h·ªØu c∆° gi√∫p g√¨ cho ƒë·∫•t?", a:["TƒÉng ƒë·ªô m√πn", "L√†m c·∫±n c·ªói ƒë·∫•t", "Gi·∫£m dinh d∆∞·ª°ng"], correct:0}
    ];

    // State
    let score = 0; let compostProgress = 0; let running=false; let level=1; let itemsInPlay=[];

    // Elements
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const itemPool = document.getElementById('itemPool');
    const compostMeter = document.getElementById('compostMeter');
    const scoreEl = document.getElementById('score');
    const logEl = document.getElementById('log');
    const compostBin = document.getElementById('compostBin');
    const quizBox = document.getElementById('quizBox');
    const quizQ = document.getElementById('quizQ');
    const quizAnswers = document.getElementById('quizAnswers');
    const closeQuiz = document.getElementById('closeQuiz');

    function log(msg){
      const time = new Date().toLocaleTimeString();
      logEl.innerHTML = `<div>[${time}] ${msg}</div>` + logEl.innerHTML;
    }

    function seedItems(){
      itemPool.innerHTML=''; itemsInPlay = [];
      // pick 6 items with some variety
      const shuffled = ITEMS.sort(()=>0.5-Math.random()).slice(0,8);
      shuffled.forEach(it=>{
        const div = document.createElement('div'); div.className='item'; div.draggable=true; div.dataset.id=it.id;
        div.innerHTML = `<div class="icon">${it.icon}</div><p>${it.name}</p>`;
        div.title = `${it.name} ‚Äî ${it.info}`;
        itemPool.appendChild(div);
        itemsInPlay.push(it);
      });
      // add drag listeners
      Array.from(document.querySelectorAll('.item')).forEach(el=>{
        el.addEventListener('dragstart',ev=>{
          ev.dataTransfer.setData('text/plain',el.dataset.id);
          setTimeout(()=>el.classList.add('hot'),10);
        })
        el.addEventListener('dragend',ev=>{el.classList.remove('hot')});
        // also click to show info
        el.addEventListener('click',()=>{
          alert(el.title);
        })
      });
    }

    compostBin.addEventListener('dragover',ev=>ev.preventDefault());
    compostBin.addEventListener('drop',ev=>{
      ev.preventDefault(); const id = ev.dataTransfer.getData('text/plain'); handleDrop(id);
    });

    function handleDrop(id){
      if(!running) return log('Nh·∫•n "B·∫Øt ƒë·∫ßu" ƒë·ªÉ ch∆°i.');
      const item = ITEMS.find(i=>i.id===id);
      if(!item) return;
      // scoring
      score += item.points * (level); // level multiplier
      if(item.type === 'green') compostProgress += 8/level; // faster at higher level? actually divide to keep balanced
      if(item.type === 'brown') compostProgress += 6/level;
      if(item.type === 'bad') compostProgress -= 15;
      if(compostProgress < 0) compostProgress = 0;
      if(compostProgress > 100) compostProgress = 100;
      updateHUD();
      log(`B·∫°n b·ªè v√†o: ${item.name}. ƒêi·ªÉm ${item.points}.`);

      // small chance to trigger quiz for education
      if(Math.random() < 0.35){ showQuiz(); }

      // if compost full => harvest
      if(compostProgress >= 100){ harvest(); }
    }

    function updateHUD(){
      compostMeter.style.width = Math.min(100,compostProgress) + '%';
      scoreEl.textContent = score;
    }

    function harvest(){
      log('B·∫°n thu ho·∫°ch ph√¢n h·ªØu c∆°! M·ª©c tr∆∞·ªüng th√†nh ƒë·∫°t 100% ‚Äî b·∫°n nh·∫≠n th∆∞·ªüng.');
      // reward
      score += 50 * level;
      compostProgress = 0;
      level += 1;
      // show celebration
      flashBin();
      seedItems();
      updateHUD();
      if(level>3){
        winGame();
      } else {
        alert('B·∫°n ƒë√£ ho√†n th√†nh c·∫•p ' + (level-1) + '! B·∫Øt ƒë·∫ßu c·∫•p m·ªõi.');
      }
    }

    function flashBin(){
      compostBin.style.transition='transform 0.25s'; compostBin.style.transform='scale(1.05)';
      setTimeout(()=>{compostBin.style.transform='scale(1)';},260);
    }

    function showQuiz(){
      const q = QUIZZES[Math.floor(Math.random()*QUIZZES.length)];
      quizQ.textContent = q.q; quizAnswers.innerHTML=''; quizBox.classList.add('show');
      q.a.forEach((ans,idx)=>{
        const b = document.createElement('button'); b.textContent = ans; b.style.margin='4px'; b.addEventListener('click',()=>{
          if(idx===q.correct){ log('ƒê√°p √°n ƒë√∫ng! B·∫°n +10 ƒëi·ªÉm.'); score += 10; } else { log('Sai. C√¢u tr·∫£ l·ªùi ƒë√∫ng: '+ q.a[q.correct]); score -= 3; }
          updateHUD(); quizBox.classList.remove('show');
        });
        quizAnswers.appendChild(b);
      });
    }
    closeQuiz.addEventListener('click',()=>{quizBox.classList.remove('show')});

    function startGame(){
      score = 0; compostProgress = 0; level = 1; running=true; seedItems(); updateHUD(); log('Tr√≤ ch∆°i b·∫Øt ƒë·∫ßu ‚Äî thu th·∫≠p v·∫≠t h·ªØu c∆° ƒë·ªÉ ·ªß ph√¢n!');
    }
    function resetGame(){ if(confirm('B·∫°n c√≥ mu·ªën ƒë·∫∑t l·∫°i tr√≤ ch∆°i?')){ score=0;compostProgress=0;level=1;running=false;seedItems();updateHUD();log('Tr√≤ ch∆°i ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t l·∫°i. Nh·∫•n B·∫Øt ƒë·∫ßu ƒë·ªÉ ch∆°i.'); } }

    function winGame(){
      running=false; alert('Ch√∫c m·ª´ng! B·∫°n ƒë√£ qua 3 c·∫•p v√† hi·ªÉu c∆° b·∫£n v·ªÅ ph√¢n h·ªØu c∆°. ƒêi·ªÉm cu·ªëi: '+score);
      log('Ng∆∞·ªùi ch∆°i chi·∫øn th·∫Øng! ƒêi·ªÉm cu·ªëi: ' + score);
    }

    // initial seed
    seedItems(); updateHUD();

    startBtn.addEventListener('click',()=>{ if(!running) startGame(); else { if(confirm('T·∫°m d·ª´ng tr√≤ ch∆°i?') ) { running=false; log('T·∫°m d·ª´ng.'); } } });
    resetBtn.addEventListener('click',resetGame);

    // Accessibility: keyboard ‚Äî press numbers to drop sample items
    document.addEventListener('keydown',ev=>{
      if(!running) return; const k = ev.key;
      if(k>='1' && k<='9'){
        const idx = Number(k)-1; if(itemsInPlay[idx]) handleDrop(itemsInPlay[idx].id);
      }
    });

    // Tips for dev: you can open console to change ITEMS and QUIZZES arrays to extend.
  </script>
</body>
</html>
